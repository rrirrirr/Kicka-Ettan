

make prod ready:
3:22 - continue with logging
21:19 - opus available

smart unit:
add confirmation for reset.
reset button color. dangerous?
dont allow double infinite and double of the same value. this should mark them as errors. red bg color
"Restores the standard configuration: inches for short distances, stone widths, broom lengths, and centimeters for long distances" change this


take the role of a senior developer and testing expert. look through frontend looking for tests we should add.
take the role of a senior developer and testing expert. look through backend looking for tests we should add.
what happens on crash? should we be notified somehow. does it restart
make sure sheet dimensions and stone dimensions are correct.
make sure backend and frontend has same dimensions for stones and sheet

text:
add info about sheet size and stone size used

features:

ux/ui:
better icons for broom and stone
only show icons/measurements available in the measurement step indicator
add tooltips for stuff
add tooltip/dialog for first time info
close/open stone indicator
new bar with measurement toggles. toggle mode and inspector?
more animations for dialogs/tooltips
loading game anim is on the left of screen. make it centered and make an animation with a red dot
change pointer when hovering over draggable stone

bug:
toggle measurement mode active when not toggled on
mobile/desktop sheet not the same

fix:
the smart measurements cm and inches rules should follow the metric/imperial setting. changing the mertic/imperial setting should change what unit is shown in smart units config

refactor:
dont repeat our selves
simplify the label and measurement code


(post release features)
local turnbased mode
qr code join
game modes:
  turn based
  ban area
custom stone and sheet dimensions
collision settings
observer mode


backend plan:

backend Production Readiness Audit - Findings & Recommendations
Summary
I've completed an audit of the Elixir/Phoenix backend for production readiness. The backend is well-structured with proper separation of concerns (GameServer, GameState, GameChannel, GameSupervisor), but several issues need to be addressed before going live.

üö® Critical Issues (Must Fix Before Launch)
1. CORS Configuration Only Allows Localhost
File: 
endpoint.ex

plug Corsica,
  origins: [~r{^http://localhost:\d+$}],  # ‚ùå Only localhost!
  allow_headers: :all,
  allow_credentials: true
Impact: Frontend won't be able to connect from production domain.

Fix: Configure CORS dynamically based on environment (use CORS_ORIGIN env variable in 
runtime.exs
).

2. SSL/HTTPS Not Enforced in Production
File: 
runtime.exs

# force_ssl: [hsts: true]  # ‚Üê Commented out!
Impact: Credentials and game data sent in plain text over HTTP.

Fix: Uncomment and enable force_ssl configuration for production.

3. No Input Validation on Game Creation
File: 
game_controller.ex

def create(conn, params) do
  game_options = %{
    total_rounds: params["total_rounds"] || 3,  # ‚ùå No validation
    stones_per_team: params["stones_per_team"] || 5,  # ‚ùå No bounds
    ...
  }
Impact: Malicious users could create games with 0 or 999999 rounds/stones, causing unexpected behavior or resource exhaustion.

Fix: Add validation with bounds checking (e.g., 1-10 rounds, 1-8 stones).

‚ö†Ô∏è Important Issues (Should Fix)
4. Deprecated Sentry Configuration
The test output shows deprecation warnings:

:included_environments option is deprecated
:backends key for logger is deprecated
Fix: Update Sentry config to use :dsn check instead of :included_environments. Update logger configuration per the deprecation warning.

5. No Rate Limiting
No rate limiting exists on any endpoints. Users can:

Create unlimited games via POST /api/games
Spam stone placement events via WebSocket
Fix: Add plug Hammer or similar rate limiting for REST API and WebSocket messages.

6. Missing Health Check Endpoint
No /health or /ready endpoint for load balancers or orchestration tools.

Fix: Add a health check endpoint that verifies database connectivity.

7. Verbose Debug Logging in Production Code
Files:

game_state.ex
 (inside functions)
require Logger
Logger.info("Player #{player_id} confirmed placement. Ready map: #{inspect(player_ready)}")
These inline require Logger statements and verbose debug logs will pollute production logs.

Fix: Remove inline require Logger (move to module top) and change verbose gameplay logs to :debug level.

8. Incomplete Collision Resolution
File: 
game_state.ex

defp do_resolve_collisions(stones) do
  # This is a placeholder for a more sophisticated collision resolution algorithm
The algorithm is marked as placeholder and limited to 10 iterations.

Fix: Either document this limitation or improve the algorithm.

üìã Test Coverage Issues
9. Minimal Test Coverage
Current tests:

Only 2 tests exist (both in 
error_json_test.exs
)
No tests for: GameServer, GameState, GameChannel, GameController, Janitor
Fix: Before production, add tests for:

GameState state transitions
GameChannel join/message handling
GameController CRUD operations
Edge cases (full game, reconnection, collision resolution)
üìù Minor Issues (Nice to Have)
10. Duplicate Comments
File: 
game_channel.ex

# Log disconnection
# Log disconnection  # ‚Üê Duplicate
11. Session Signing Salt Hardcoded
The signing salt in endpoint.ex should probably be in config/env vars for security.

12. No Request Timeout Configuration
No explicit timeouts on GenServer calls which could cause issues under load.

User Review Required
IMPORTANT

Before I create a detailed implementation plan for fixes, I need your input on:

Scope: Which issues do you want me to address right now vs later?
CORS: What production domain(s) should be allowed?
Rate Limiting: What limits seem reasonable? (e.g., 10 games/hour, 100 messages/minute)
Testing: Should I add test coverage for critical paths, or is that a separate effort?
Verification Plan
Once fixes are implemented, verification will include:

Automated Tests
Run existing tests: mix test
Run Credo linter: mix credo
Run Dialyzer (if passing): mix dialyzer
Manual Verification
Test CORS with production domain
Verify SSL redirect works
Test input validation rejection
Check logs don't expose sensitive data
